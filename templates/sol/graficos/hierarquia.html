<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hierarquia de Setores x Serviços</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #d0d0ff;
            padding: 15px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }


        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }


        /* Container principal para o gráfico */
        #organograma {
            width: 90%; /* Ajuste a largura conforme necessário */
            max-width: 1200px;
            height: 700px; /* Ajuste a altura conforme necessário */
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }


        /* Estilo para o botão Voltar */
        .back-button {
            margin-top: 30px;
        }


        .back-button a {
            display: block;
            padding: 10px 20px;
            text-decoration: none;
            color: #fff;
            background-color: #007bff;
            border-radius: 20px;
            transition: background-color 0.3s ease-in-out;
            text-align: center;
            font-weight: bold;
        }


        .back-button a:hover {
            background-color: white;
            color: blue;
        }
    </style>
</head>
<body>


<h1>&#x1F578; Hierarquia de Setores x Serviços</h1>


<div id="organograma"></div>


<div class="back-button">
    <a href="/sol/graficos/menu">
        &#x2B05; Voltar ao Menu de Gráficos
    </a>
</div>


<script>
    // Inicializa o objeto ECharts no container
    var chartDom = document.getElementById('organograma');
    var myChart = echarts.init(chartDom);
    var option;


    // -----------------------------------------------------------
    // 1. CARREGAMENTO DE DADOS VIA FLASK/JINJA
    // -----------------------------------------------------------
    // A variável 'data' é injetada pelo Flask (View) como uma string JSON.
    // O filtro '| tojson | safe' garante que a string seja renderizada corretamente.
    var jsonString = '{{ dados | tojson | safe }}';


    // Converte a string JSON em um objeto JavaScript
    var data;
    try {
        data = JSON.parse(jsonString);
    } catch (e) {
        console.error("Erro ao analisar dados JSON do organograma:", e);
        data = {name: 'Erro de Dados', children: []};
    }


    // Adiciona um nó raiz se o JSON for uma lista (caso necessário)
    // O ECharts espera que o 'data' seja uma lista contendo o nó raiz.
    var dataArray = [data];


    // -----------------------------------------------------------
    // 2. CONFIGURAÇÃO DO ECHARTS
    // -----------------------------------------------------------
    option = {
        title: {
            text: 'Hierarquia Setores x Serviços',
            subtext: 'Clique nos nós para expandir/colapsar'
        },
        tooltip: {
            trigger: 'item',
            triggerOn: 'mousemove'
        },
        series: [
            {
                type: 'tree',


                data: dataArray, // Usa o array de dados


                // Configuração do layout da árvore
                layout: 'orthogonal',
                orient: 'LR', // Orientação: Da Esquerda para a Direita
                symbolSize: 8,
                initialTreeDepth: 1, // Mostra o nó raiz e o primeiro nível (Montadoras) expandidos.


                label: {
                    position: 'left',
                    verticalAlign: 'middle',
                    align: 'right',
                    fontSize: 12
                },


                leaves: {
                    // Estilo para os nós folha (Versões)
                    label: {
                        position: 'right',
                        verticalAlign: 'middle',
                        align: 'left'
                    }
                },


                expandAndCollapse: true, // Permite expandir/colapsar


                animationDuration: 1000,
                animationDurationUpdate: 1250
            }
        ]
    };


    // Aplica as opções ao gráfico
    option && myChart.setOption(option);


    // Garante que o gráfico se redimensione com a janela
    window.addEventListener('resize', myChart.resize);


</script>
</body>
</html>
